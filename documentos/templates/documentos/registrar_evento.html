<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Evento</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'documentos/css/registrar_evento.css' %}">
</head>
<body class="container mt-5">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Gestión Documental</a>
            <button class="btn btn-danger" onclick="window.location.href='{% url 'logout' %}'">Cerrar Sesión</button>
        </div>
    </nav>

    <div class="text-center mb-4">
        <h2 class="fw-bold">Registrar Evento para el Documento</h2>
        <div class="document-info">
            <p class="doc-code"><strong>Código del Documento:</strong> {{ documento.codigo }}</p>
            <p class="doc-name"><strong>Nombre del Documento:</strong> {{ documento.nombre }}</p>
        </div>
    </div>

    {% if messages %}
    {% for message in messages %}
        <div class="alert 
            {% if message.tags == 'error' %}alert-danger
            {% elif message.tags == 'success' %}alert-success
            {% elif message.tags == 'warning' %}alert-warning
            {% else %}alert-info{% endif %} 
            alert-dismissible fade show" role="alert">
            
            <strong>{{ message }}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
    {% endif %}


    <div class="card p-4 shadow-lg">
        <form method="POST">
            {% csrf_token %}

            <!-- Sección No Editable -->
            <fieldset class="bg-light p-3 rounded">
                <legend class="text-primary fw-bold">Información Actual del Documento (No Editable)</legend>

                <div class="mb-3">
                    <label class="form-label">Usuario</label>
                    <input type="text" class="form-control" value="{{ usuario.username }}" readonly>
                </div>

                <div class="mb-3">
                    <label class="form-label">Estado Actual</label>
                    {{ form.estado_actual }}
                </div>

                <div class="mb-3">
                    <label class="form-label">Etapa Actual</label>
                    {{ form.etapa_actual }}
                </div>

                <div class="mb-3">
                    <label class="form-label">Versión Actual</label>
                    {{ form.version_actual }}
                </div>

                <div class="mb-3">
                    <label class="form-label">Número de Versión</label>
                    {{ form.numero_version }}
                </div>

                <div class="mb-3">
                    <label class="form-label">Estado de la Versión</label>
                    {{ form.estado_version }}
                </div>

                <div class="mb-3">
                    <label class="form-label">Revisado</label>
                    <input type="text" class="form-control" value="{% if documento.revisado %}Sí{% else %}No{% endif %}" readonly>
                </div>

                <div class="mb-3">
                    <label class="form-label">Aprobado</label>
                    <input type="text" class="form-control" value="{% if documento.aprobado %}Sí{% else %}No{% endif %}" readonly>
                </div>

                <div class="mb-3">
                    <label class="form-label">Ruta Actual del Documento</label>
                    <input type="text" class="form-control" value="{{ documento.ruta_actual }}" readonly>                
                </div>
            </fieldset>

            <!-- Sección Editable -->
            <fieldset class="border border-primary p-3 rounded mt-4">
                <legend class="text-primary fw-bold">Información del Evento (Editable)</legend>

                <div class="mb-3">
                    <label class="form-label">Tipo de Evento</label>
                    {{ form.tipo_evento }}
                </div>
                {% if messages_list %}
                {% for category, message in messages_list %}
                    <div class="alert alert-{% if category == 'error' %}danger{% else %}success{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
                {% endif %}
            

                <div class="mb-3">
                    <label class="form-label">Comentarios (Obligatorio)</label>
                    {{ form.comentarios }}
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Actualizar Ruta del Documento</label>
                    {{ form.ruta_actual }}
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Usuario Interesado 1</label>
                    {{ form.usuario_interesado_1 }}
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Usuario Interesado 2</label>
                    {{ form.usuario_interesado_2 }}
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Usuario Interesado 3</label>
                    {{ form.usuario_interesado_3 }}
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-3">Registrar Evento</button>
            </fieldset>
        </form>

        <a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">Volver al Dashboard</a>
    </div>

</body>
</html>
